<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>í”„ë¡ íŠ¸-ë°±ì—”ë“œ ì—°ê²° ë§ˆì§€ë§‰ ì˜ˆì œ!</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css" />
    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
    <style>
        .make-center {
            text-align: center;
        }

        .star-list {
            width: 500px;
            margin: 20px auto 0 auto;
        }

        .star-name {
            display: inline-block;
        }

        .star-name:hover {
            text-decoration: underline;
        }

        .card {
            margin-bottom: 15px;
        }
        #alert-like{
        }
        #alert-delete{

        }
    </style>
    <script>
        $(document).ready(function () {
            // index.html ë¡œë“œê°€ ì™„ë£Œë˜ë©´ ìë™ìœ¼ë¡œ show_star() í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
            show_star();
        });

        function show_star() {
             //1. #star_boxì˜ ë‚´ë¶€ html íƒœê·¸ë¥¼ ëª¨ë‘ ì‚­ì œí•©ë‹ˆë‹¤.

            $('#star_box').empty();

            //2. ì„œë²„ì— 1) GET ë°©ì‹ìœ¼ë¡œ, 2) /api/list ë¼ëŠ” ì£¼ì†Œë¡œ stars_listë¥¼ ìš”ì²­í•©ë‹ˆë‹¤.
            $.ajax({
                type: 'GET',
                url: '/api/list',
                data: {},
                success: function (response) {
                    if (response['result'] == 'success') {
                        //3. ì„œë²„ê°€ ëŒë ¤ì¤€ stars_listë¥¼ starsë¼ëŠ” ë³€ìˆ˜ì— ì €ì¥í•©ë‹ˆë‹¤.
                        stars = response['stars_list'];
                        
                        //4. for ë¬¸ì„ í™œìš©í•˜ì—¬ stars ë°°ì—´ì˜ ìš”ì†Œë¥¼ ì°¨ë¡€ëŒ€ë¡œ ì¡°íšŒí•©ë‹ˆë‹¤.
                        for(let i=0; i<stars.length ; i++){
                            //5. stars[i] ìš”ì†Œì˜ name, url, img_url, recent, like í‚¤ ê°’ì„ í™œìš©í•˜ì—¬ ê°’ì„ ì¡°íšŒí•©ë‹ˆë‹¤.

                            let starName = stars[i]['name'];
                            let starUrl = stars[i]['url'];
                            let starImg = stars[i]['img_url'];
                            let starRecent = stars[i]['recent'];
                            let starLike = stars[i]['like'];

                            temp_html=`<div class="card">
                                        <div class="card-content">
                                            <div class="media">
                                                <div class="media-left">
                                                    <figure class="image is-48x48">
                                                        <img src="${starImg}"
                                                            alt="Placeholder image" />
                                                    </figure>
                                                </div>
                                                <div class="media-content">
                                                    <a href="#" target="_blank" class="star-name title is-4">${starName} (ì¢‹ì•„ìš”: ${starLike})</a>
                                                    <p class="subtitle is-6">${starRecent}</p>
                                                </div>
                                            </div>
                                        </div>
                                        <footer class="card-footer">
                                            <a href="#" onclick="like_star('${starName}')" class="card-footer-item has-text-info">
                                                ìœ„ë¡œ!
                                                <span class="icon">
                                                    <i class="fas fa-thumbs-up"></i>
                                                </span>
                                            </a>
                                            <a href="#" onclick="delete_star('${starName}')" class="card-footer-item has-text-danger">
                                                ì‚­ì œ
                                                <span class="icon">
                                                    <i class="fas fa-ban"></i>
                                                </span>
                                            </a>
                                        </footer>
                                    </div>`;
                            $('#star-box').append(temp_html);
                        }
                    }
                }
            });
        }

        function like_star(name) {

            //1. ì„œë²„ì— 1) POST ë°©ì‹ìœ¼ë¡œ, 2) /api/like ë¼ëŠ” urlì—, 3) name_giveë¼ëŠ” ì´ë¦„ìœ¼ë¡œ nameì„ ì „ë‹¬í•©ë‹ˆë‹¤. (ì°¸ê³ ) POST ë°©ì‹ì´ë¯€ë¡œ data: {'name_give': name} ê³¼ ê°™ì€ ì–‘ì‹ì´ ë˜ì–´ì•¼í•©ë‹ˆë‹¤!
            $.ajax({
                type: 'POST',
                url: '/api/like',
                data: { 'name_give':name },

                success: function (response) {
                    if (response['result'] == 'success') {
                        alertLike(name);
                    }
                    window.location.reload();

                }
            });

         //3. ë³€ê²½ëœ ì •ë³´ë¥¼ ë°˜ì˜í•˜ê¸° ìœ„í•´ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.

        }

        function delete_star(name) {
            $.ajax({
                type: 'POST',
                url: '/api/delete',
                data: {'name_give':name},
                success: function (response) {
                    if (response['result'] == 'success') {
                        alertDelete(name);
                        window.location.reload()
                    }
                }
            });
        }

        function alertLike(name){
            temp_html=`<div class="container make-center" id="alert-like">
                        ${name}ì˜ ì¢‹ì•„ìš”ê°€ +1 ìƒìŠ¹í•˜ì˜€ìŠµë‹ˆë‹¤.
                        </div>`;
            $('.hero-body').append(temp_html);
            $('#alert-like').hide(5000);
        }

        function alertDelete(){
            temp_html=`<div class="container make-center" id="alert-delete">
                        ${name}ì˜ ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤..
                        </div>`;
            $('.hero-body').append(temp_html);
            $('#alert-delete').hide(5000);
        }

    </script>
</head>

<body>
    <section class="hero is-warning">
        <div class="hero-body">
            <div class="container make-center">
                <h1 class="title">
                    ë§ˆì´ í˜ì´ë³´ë¦¿ ë¬´ë¹„ìŠ¤íƒ€ğŸ˜†
                </h1>
                <h2 class="subtitle">
                    ìˆœìœ„ë¥¼ ë§¤ê²¨ë´…ì‹œë‹¤
                </h2>
            </div>
            <!-- alert ê°€ ì‚½ì…ë©ë‹ˆë‹¤.-->
        </div>
    </section>
    <div class="star-list" id="star-box">
        <!--star listê°€ ì‚½ì…ë©ë‹ˆë‹¤.-->
    </div>
</body>

</html>